# https://github.com/ntalekt/homeassistant/blob/master/automation/notification_text.yaml

##########################################################
## Pushbullet - SSL Expiration < 16
##########################################################
- alias: Notification Text - SSL Expiration 15 days
  trigger:
    - platform: numeric_state
      entity_id: sensor.ssl_certificate_expiry
      below: 16
  action:
    - service: notify.pushbullet
      data:
        title: "Home Assistant"
        message: "SSL HASS expire dans {{ states.sensor.ssl_certificate_expiry.state }} jours !"


##########################################################
## Notify if Gearbest price drops
##########################################################
- alias: Notification - Baisse des prix Gearbest
  trigger:
    - platform: state
      entity_id: binary_sensor.gearbest_door_sensor_decreasing
      to: 'on'
    - platform: state
      entity_id: binary_sensor.gearbest_motion_sensor_decreasing
      to: 'on'
    - platform: state
      entity_id: binary_sensor.gearbest_switch_decreasing
      to: 'on'
    - platform: state
      entity_id: binary_sensor.gearbest_temp_sensor_decreasing
      to: 'on'
  action:
    - service: notify.pushbullet
      data_template:
        title: "Home Assistant"
        message: 'Prix de {{trigger.to_state.attributes.friendly_name}} en baisse.'

##########################################################
## Principal Door - Open for 5 minutes
##########################################################
- alias: Notification - Entree ouverte depuis 5 min
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0001de6011
      to: 'on'
      for:
        minutes: 5
  condition:
    - condition: state
      entity_id: group.Famille
      state: 'home'
  action:
    - service: notify.pushbullet
      data:
        title: "Home Assistant"
        message: "La porte d'entree est ouverte depuis 5 minutes."

##########################################################
## New version of Home Assistant
##########################################################
- alias: 'Notification - Nouvelle version de Home Assistant'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.pushbullet
    data:
      message: 'Nouvelle version de Home Assistant disponible.'

##########################################################
## Pushbullet - Low Battery Alert
##########################################################
# https://community.home-assistant.io/t/howto-create-battery-alert-without-creating-a-template-for-every-device/30576/6
- alias: 'Battery Alert'
  trigger:
    - platform: time
      at: '10:00:00'
    - platform: time
      at: '18:00:00'
  condition:
    condition: template
    value_template: "{% if states('sensor.low_battery') %}true{% endif %}"
  action:
    - service: persistent_notification.create
      data_template:
        title: Low Battery
        message: "{{ states('sensor.low_battery') }}"
        notification_id: low-battery-alert
    - service: notify.pushbullet
      data:
        title: "Home Assistant"
        message: "Batterie faible pour {{ states('sensor.low_battery') }}"

